<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Secret Message Encoder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      text-align: center;
      padding: 20px;
    }
    h2 {
      color: #333;
    }
    textarea, input {
      width: 90%;
      margin: 10px 0;
      padding: 10px;
      font-size: 14px;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      color: white;
    }
    #encryptBtn { background: orange; }
    #decryptBtn { background: black; }
    #resetBtn   { background: blue; }
    #output {
      background: white;
      padding: 10px;
      margin-top: 20px;
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <h2>ENTER TEXT FOR ENCRYPTION & DECRYPTION</h2>
  <textarea id="message" rows="5" placeholder="Type your message here"></textarea>
  
  <h2>ENTER SECRET KEY</h2>
  <input type="password" id="password" placeholder="At least 4 characters">
  
  <div>
    <button id="encryptBtn">ENCRYPT</button>
    <button id="decryptBtn">DECRYPT</button>
    <button id="resetBtn">RESET</button>
  </div>
  
  <div id="output"></div>
  
  <script>
    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }
    
    document.getElementById("encryptBtn").addEventListener("click", async () => {
      const password = document.getElementById("password").value;
      const message = document.getElementById("message").value.trim();
      
      if (password.length >= 4 && message) {
        const hashKey = await sha256(password);
        const combined = `${hashKey}:${message}`;
        const encoded = btoa(unescape(encodeURIComponent(combined)));
        document.getElementById("output").textContent = "ENCRYPTED TEXT:\n" + encoded;
      } else {
        alert("SECRET KEY MUST BE AT LEAST 4 CHARACTERS AND MESSAGE CANNOT BE EMPTY.");
      }
    });
    
    document.getElementById("decryptBtn").addEventListener("click", async () => {
      const password = document.getElementById("password").value;
      const encodedMessage = document.getElementById("message").value.trim();
      
      if (password.length >= 4 && encodedMessage) {
        try {
          const decoded = decodeURIComponent(escape(atob(encodedMessage)));
          const [storedHash, realMessage] = decoded.split(":", 2);
          const currentHash = await sha256(password);
          
          if (storedHash === currentHash) {
            document.getElementById("output").textContent = "DECRYPTED TEXT:\n" + realMessage;
          } else {
            alert("SECRET KEY DOESN'T MATCH!");
          }
        } catch (e) {
          alert("FAILED TO DECRYPT.\n\n" + e.message);
        }
      } else {
        alert("SECRET KEY MUST BE AT LEAST 4 CHARACTERS AND MESSAGE CANNOT BE EMPTY.");
      }
    });
    
    document.getElementById("resetBtn").addEventListener("click", () => {
      document.getElementById("password").value = "";
      document.getElementById("message").value = "";
      document.getElementById("output").textContent = "";
    });
  </script>
</body>
</html>
